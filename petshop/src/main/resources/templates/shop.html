<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
  <meta charset="UTF-8">
  <title>PetShop</title>
</head>
<body>
<h1>Добро пожаловать в магазин!</h1>

<p>Имя: <b th:text="${user.name}"></b></p>
<p>Баланс: <b th:text="${user.balance}"></b> ₸</p>

<form th:action="@{/topup}" method="post">
  <input type="number" name="amount" placeholder="Сколько пополнить?" required />
  <button type="submit">Пополнить</button>
</form>

<h2>Товары:</h2>
<table border="1" cellpadding="5">
  <tr>
    <th>Название</th>
    <th>Цена</th>
    <th>Действия</th>
  </tr>
  <tr th:each="product : ${products}">
    <td th:text="${product.name}"></td>
    <td th:text="${product.price}"></td>
    <td>
      <!-- Кнопка купить для всех -->
      <form th:action="@{/buy}" method="post" style="display:inline;">
        <input type="hidden" name="id" th:value="${product.id}" />
        <button type="submit">Купить</button>
      </form>


      <!-- Редактировать/Удалить-->
      <span sec:authorize="hasRole('ADMIN')">
<a th:href="@{'/edit/' + ${product.id}}">Редактировать</a>
<a th:href="@{'/delete/' + ${product.id}}"
   onclick="return confirm('Удалить товар?')">Удалить</a>
      </span>
    </td>
  </tr>
</table>


<!-- Админ часть-->
<div sec:authorize="hasRole('ADMIN')">
  <h3>Добавить товар</h3>
  <form th:action="@{/save}" method="post">
    <input type="text" name="name" placeholder="Название" required/>
    <input type="number" name="price" placeholder="Цена" required/>
    <input type="text" name="description" placeholder="Описание"/>
    <button type="submit">Добавить</button>
  </form>
</div>

<p style="color: green;" th:text="${message}"></p>
</body>
</html>
